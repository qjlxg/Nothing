# Clash Meta (mihomo) 配置文件
ipv6: true

mixed-port: 17890
port: 0
socks-port: 0
redir-port: 0
tproxy-port: 0

external-controller: 127.0.0.1:19090 # RESTful API 监听地址
external-controller-cors:
  allow-origins:
    - "https://metacubex.github.io"
    - "https://yacd.metacubex.one"
  allow-private-network: false
secret: "@NuoFang" # 外部控制器RESTful API访问密钥

allow-lan: false
# bind-address: "*"
# lan-allowed-ips:
#   - 0.0.0.0/0
#   - ::/0
# lan-disallowed-ips:
#   -
# authentication:
#   - "user1:pass1"
#   - "user2:pass2"
# skip-auth-prefixes:
#   - 127.0.0.1/8
#   - ::1/128

disable-keep-alive: true # android端默认为true
# keep-alive-idle: 765 # 链接闲置后 765+15*9=15 分钟关闭无效长链接
# keep-alive-interval: 15

clash-for-android:
  append-system-dns: false

global-client-fingerprint: chrome
global-ua: "clash.meta/mihomo"

mode: rule
log-level: warning
find-process-mode: strict

profile:
  store-selected: true
  store-fake-ip: true

unified-delay: true
tcp-concurrent: true
etag-support: true

inbound-tfo: true
inbound-mptcp: true

geodata-mode: false # 不再使用 geo 规则集
geodata-loader: memconservative
geosite-matcher: mph
geo-auto-update: false
geo-update-interval: 48
# geox-url:
#   asn: https://gh.nuofang.nyc.mn/https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-ASN.mmdb
#   geosite: https://gh.nuofang.nyc.mn/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
#   geoip: https://gh.nuofang.nyc.mn/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat
#   mmdb: https://gh.nuofang.nyc.mn/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb
# external-doh-server: /dns-query
# external-ui-name: xd #  合并为 external-ui/xd，非必须，更新时会更新到指定文件夹，不配置则直接更新到 external-ui 目录
# external-ui-url: "https://gh.nuofang.nyc.mn/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

tun:
  mtu: 9000 # 兼容性未知
  strict-route: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  auto-redirect: true
  endpoint-independent-nat: false
  dns-hijack:
    - any:53
    - "tcp://any:53"

hosts:
  "localhost": "127.0.0.1"
  # bing
  "cn.bing.com": "www.bing.com"
  # cf域名优选
  # "+.nuofang.nyc.mn": "cf.090227.xyz"
  # "+.nuofang.us.kg": "cf.090227.xyz"
  "+.yukihasu.top": "cf.090227.xyz"
  "+.czrk168.top": "cf.090227.xyz"
  "+.cloudflare.com": "cf.090227.xyz"
  # "+.pages.dev": "cf.090227.xyz"
  # "+.cloudflareclient.com": "cf.090227.xyz"
  # emby
  "+.123456.al": "cf.090227.xyz"
  "+.nijigem.by": "cf.090227.xyz"
  # # 哔咔漫画
  # "+.picacomic.com": "cf.090227.xyz" # 仅分流一
  # # nhentai漫画
  # "+.nhentai.net": "cf.090227.xyz"
  # # pixiv镜像源
  "+.pixiv.re": "cf.090227.xyz"
  # # hanime1.me #hembed.com是视频服务器，Fastly托管，无需优选
  # "+.hanime1.me": "cf.090227.xyz"
  # # iwara 晚高峰效果不佳，土豆视频服务器
  # "+.iwara.tv": "cf.090227.xyz"
  # # netflav.com
  # "+.netflav.com": "cf.090227.xyz"
  # # tsumino.com
  # "+.tsumino.com": "cf.090227.xyz"
  # # 群友
  # "+.beacon-scheduler.sawahara.host": "cf.090227.xyz"
  # "+.latestfile.zip": "cf.090227.xyz"
  # "+.lingcha-kernel.sawahara.host": "cf.090227.xyz"
  # ntp优化
  "time.windows.com": "ntp.tencent.com"
  "time.nist.gov": "ntp.tencent.com"
  "pool.ntp.org": "ntp.tencent.com"
  "time.android.com": "ntp.tencent.com"
  # 无法优化的
  # # Eh (e-hentai) 连接直接被关闭
  # "+.e-hentai.org": "cf.090227.xyz"
  #
  # 不是cf
  # hitomi doujins

dns:
  enable: true
  ipv6: true
  ipv6-timeout: 80
  use-hosts: true
  use-system-hosts: false
  respect-rules: false
  cache-algorithm: arc
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  default-nameserver:
    # - "quic://223.5.5.5#DIRECT"
    - "https://223.5.5.5/dns-query#DIRECT&h3=true"

  proxy-server-nameserver:
    - "https://160195.alidns.com/dns-query#h3=true"
    # - "quic://160195.alidns.com"
    # - "tls://dot-cbe28e9d.dot.pub" # 腾讯

  nameserver:
    - "https://160195.alidns.com/dns-query#DIRECT&h3=true"
    # - "quic://160195.alidns.com#DIRECT"

  direct-nameserver: # 专用于direct出口域名解析的 DNS 服务器，非必要配置项，如果不填则遵循nameserver-policy、nameserver和fallback的配置
    #! 部分地区光猫会强制安装反诈上报插件，此时不应使用任何明文dns
    # 通用 DNS
    - "udp://223.5.5.5#DIRECT"
    - "udp://223.6.6.6#DIRECT"
    # - "https://160195.alidns.com/dns-query#DIRECT&h3=true"

    # 江西电信专用 DNS
    # - "udp://202.101.224.69#DIRECT"
    # - "udp://202.101.226.68#DIRECT"
  direct-nameserver-follow-policy: true # 是否遵循nameserver-policy，默认为不遵守，仅当direct-nameserver不为空时生效

  nameserver-policy:
    "+.nyc.mn,+.us.kg,+.eu.org,+.cloudns.ch,+.dns-dynamic.net,+.filegear-sg.me,+.speed.xn--1jq721i.cn,+.090227.xyz,+.182682.xyz,+.microsoft-ppe.com,+.onedrive.com,+.live.com,+.microsoft.com,+.microsoft,+.ms,+.office365.com,+.office.net,+.akamaized.net,+.msftauth.net,+.skype.com,+.windows.com,+.msauth.net,+.microsoftpersonalcontent.com,+.msftconnecttest.com,+.msftncsi.com,+.goog,+.xn--ngstr-lra8j.com,+.xn--ngstr-cn-8za9o.com,+.googleapis.cn,+.google.com,+.google.cn,+.githubcopilot.com,+.apple.com,+.nvidia.cn,+.nvidia.com":
      - "https://160195.alidns.com/dns-query#DIRECT&h3=true"
      # - "quic://160195.alidns.com#DIRECT"

    "+.bing.com,+.bingapis.com":
      - "tcp://8.8.8.8#PROXY"
      - "tcp://8.8.4.4#PROXY"
    # "rule-set:Ad": # 效果不佳
    #   - "rcode://success"

  fallback:
    # - "udp://8.8.8.8#PROXY"
    # - "tcp://8.8.8.8#PROXY"
    # - "tls://dns.google#PROXY"
    - "https://dns.google/dns-query#PROXY"
  fallback-filter:
    geoip: false
    # geoip-code: CN
    ipcidr:
      # 国内污染及反诈中心
      - 36.135.82.110/32 # 中国/吉林/移动
      - 39.102.194.95/32 # 中国/北京/阿里云
      - 61.160.148.90/32 # 中国/江苏/南京/电信
      - 101.35.177.86/32 # 中国/上海/腾讯云
      - 106.74.25.198/32 # 中国/内蒙古/呼伦贝尔/联通
      - 112.15.232.43/32 # 移动
      - 124.236.16.201/32 # 中国/河北/石家庄/电信
      - 182.43.124.6/32 # 中国/贵州/贵阳/电信
      - 211.137.117.149/32 # 中国/陕西/西安/移动
      - 211.139.145.129/32 # 中国/广东/广州/移动
      - 221.180.160.221/32 # 中国/辽宁/沈阳/移动
      - 221.228.32.13/32 # 中国/江苏/镇江/电信
      - 223.75.236.241/32 # 中国/湖北/武汉/移动
      #
      - 222.222.222.222/32 # 污染
      - 69.167.164.199/32 # abc.test.com 污染
      - 96.110.0.0/16
      - 142.171.98.53/32 # note.sycki.com，访问时污染
      #
      - 0.0.0.0/8
      - 127.0.0.0/8
      - 100.64.0.0/10
      - 240.0.0.0/4 # 包含 255.255.255.255
      - ::/128
      - ::1/128
      #
      - 10.0.0.0/8
      - 172.16.0.0/12
      - 169.254.0.0/16
      - 192.0.0.0/24
      - 192.0.2.0/24
      - 192.88.99.0/24
      - 192.168.0.0/16
      - 198.18.0.0/15
      - 198.51.100.0/24
      - 203.0.113.0/24
      - 224.0.0.0/4
      # - 100.100.0.0/8 #公共 IPv4 地址段，会出现在公网
      # - ::/96 #已废弃，可能会出现在公网
      # - ::ffff:0:0/96
      # - 64:ff9b::/96
      # - 100::/64
      # - 2002::/16
      # # - 2001::/32 #全球单播地址，会出现在公网
      # - 2001:db8::/32
      # - fc00::/7
      # - fec0::/10 #已废弃，可能会出现在公网
      # - ff00::/8
  domain:
    # bing国内版
    - "+.cn.bing.com"
    # 污染
    - "+.js96110.com.cn"
    #
    - "+.test.com"
    - "+.lan"
    - "+.localdomain"
    - "+.example"
    - "+.invalid"
    - "+.localhost"
    - "+.test"
    - "+.local"
    - "+.arpa"
    - "+.home"
    - "+.onion"
    - "+.bit"
    - "+.i2p"
    - "+.gnu"
    - "+.internal"
    - "+.intranet"
    - "+.private"
    - "+.corp"
    - "+.localnet"
    - "+.example.com"
    - "+.example.net"
    - "+.example.org"
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    # - "rule-set:cn" # 全部国内域名使用真实IP
    # 腾讯
    - "+.cdn-go.cn"
    # 网易易盾号码认证
    - "+.ye.dun.163yun.com"
    # 袤博秒验
    - "+.log-verify.mob.com"
    - "+.cdn-api-verify.mob.com"
    - "+.cache-verify.mob.com"
    # 极验
    - "+.geetest.com"
    # bing
    - "+.bing.com"
    - "+.bingapis.com"
    - "+.189.cn"
    - "+.lan"
    - "+.direct"
    - "+.cable.auth.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.network-test.debian.org"
    - "+.detectportal.firefox.com"
    - "+.resolver1.opendns.com"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.xbox.*.microsoft.com"
    - "+.xboxlive.com"
    - "+.stun.*"
    - "+.global.turn.twilio.com"
    - "+.global.stun.twilio.com"
    - "+.app.yinxiang.com"
    - "+.injections.adguard.org"
    - "+.local.adguard.org"
    - "+.localhost.*.qq.com"
    - "+.localhost.*.weixin.qq.com"
    - "+.logon.battlenet.com.cn"
    - "+.logon.battle.net"
    - "+.blzstatic.cn"
    - "+.music.163.com"
    - "+.126.net"
    - "+.musicapi.taihe.com"
    - "+.music.taihe.com"
    - "+.songsearch.kugou.com"
    - "+.trackercdn.kugou.com"
    - "+.kuwo.cn"
    - "+.api-jooxtt.sanook.com"
    - "+.joox.com"
    - "+.y.qq.com"
    - "+.music.tc.qq.com"
    - "+.stream.qqmusic.qq.com"
    - "+.aqqmusic.tc.qq.com"
    - "+.xiami.com"
    - "+.music.migu.cn"
    - "+.proxy.golang.org"
    - "+.mcdn.bilivideo.cn"
    - "+.cmpassport.com"
    - "+.id6.me"
    - "+.open.e.189.cn"
    - "+.opencloud.wostore.cn"
    - "+.id.mail.wo.cn"
    - "+.mdn.open.wo.cn"
    - "+.hmrz.wo.cn"
    - "+.nishub1.10010.com"
    - "+.enrichgw.10010.com"
    - "+.wosms.cn"
    - "+.jegotrip.com.cn"
    - "+.icitymobile.mobi"
    - "+.pingan.com.cn"
    - "+.cmbchina.com"
    - "+.10099.com.cn"
    - "+.microdone.cn"
    - "+.pool.ntp.org"
    - "+.ntp.*.com"
    - "+.time.*.com"
    - "+.time.*.gov"
    - "+.time.*.edu.cn"
    - "+.ntp.org.cn"
    - "PDC._msDCS.*.*"
    - "DC._msDCS.*.*"
    - "GC._msDCS.*.*"
    # 指向内网的域名
    - "+.arubanetworks.com"
    - "+.router.asus.com"
    - "+.asusrouter.com"
    - "+.oasisauth.h3c.com"
    - "+.routerlogin.com"
    - "+.tplogin.cn"
    - "+.miwifi.com"
    - "+.test.steampowered.com"
    - "passenger.t3go.cn"
    - "yunbusiness.ccb.com"
    - "wxh.wo.cn"
    - "gate.lagou.com"
    - "www.abchina.com.cn"
    - "+.mobile-bank.psbc.com"

sniffer:
  enable: true
  parse-pure-ip: true
  override-destination: true
  force-dns-mapping: false
  force-domain:
    - +.netflix.com
    - +.nflxvideo.net
    - +.amazonaws.com
    - +.media.dssott.com
    # - "+.v2ex.com"
  skip-dst-address: # 跳过目标地址
    # Telegram 纯IP
    - 91.105.192.0/23
    - 91.108.4.0/22
    - 91.108.8.0/21
    - 91.108.16.0/21
    - 91.108.56.0/22
    - 95.161.64.0/20
    - 149.154.160.0/20
    - 185.76.151.0/24
    - 2001:67c:4e8::/48
    - 2001:b28:f23c::/47
    - 2001:b28:f23f::/48
    - 2a0a:f280::/32
    - 109.239.140.0/24 # Telegram Messenger LLP
    - 5.28.192.0/18 # IPFFM - Internet Provider Frankfurt GmbH
    # DNS
    - 1.1.1.1/32
    - 1.0.0.1/32
    - 8.8.8.8/32
    - 8.8.4.4/32
  skip-domain:
    - "+.alidns.com"
    # bing
    - "+.bing.com"
    - "+.bingapis.com"
    # windows连接检测
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    #
    - "+.push.apple.com"
    - "+.io.mi.com"
    # - "+.copilot.microsoft.com"
    # - "+.apple.com"
    # - "www.google.com"
  sniff:
    HTTP:
      ports: [80, 8080]
      override-destination: true
    TLS:
      ports: [443, 8443, 853]
      override-destination: true
    QUIC:
      ports: [443, 8443, 853]
      override-destination: true

proxies: []

# 锚点
204Set: &204Set
  url: "https://www.youtube.com/generate_204"
  expected-status: 204
  interval: 450
  timeout: 10000
  lazy: true

groupsSet: &groupsSet
  tfo: true
  mptcp: true
  tolerance: 40
  max-failed-times: 2
  <<: *204Set

proxy-groups:
  - name: PROXY
    type: select
    proxies:
      - 🚀自动选择
    include-all-proxies: true
    <<: *groupsSet

  - name: 🚀自动选择
    type: url-test
    include-all-proxies: true
    <<: *groupsSet

rules:
  - MATCH,PROXY
